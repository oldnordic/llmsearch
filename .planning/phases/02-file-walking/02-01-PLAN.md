---
phase: 02-file-walking
plan: 01
type: execute
depends_on: []
files_modified: [src/main.rs]
autonomous: true
---

<objective>
Integrate ignore crate for gitignore-aware directory traversal.

Purpose: Walk the directory tree while respecting .gitignore and other ignore files. This provides the file list that phase 3 will search.
Output: File walker using ignore crate that produces a list of file paths
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 1 established:
@src/main.rs - Main function with Phase 2 placeholder
@src/cli.rs - CLI args with --root, --glob, --pattern, --limit, --json

# Prior plan creates CLI args structure
@.planning/phases/01-project-scaffolding/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create file walking function with ignore crate</name>
  <files>src/main.rs</files>
  <action>Add a `walk_files` function that uses the ignore crate:

1. Add `use ignore::Walk;` at top
2. Create function after main():
```rust
fn walk_files(root: &str, globs: &[String]) -> Vec<String> {
    let mut walker = Walk::new(root);

    // Filter by glob patterns if provided
    if !globs.is_empty() {
        // Build a combined glob filter
        // For now, just collect all files - glob filtering comes in 02-02
    }

    let mut files = Vec::new();
    for result in walker {
        match result {
            Ok(entry) => {
                if let Some(path) = entry.path().to_str() {
                    // Only include files, not directories
                    if entry.file_type().map_or(false, |ft| ft.is_file()) {
                        files.push(path.to_string());
                    }
                }
            }
            Err(err) => {
                eprintln!("Warning: {}", err);
            }
        }
    }
    files
}
```

3. Update main Phase 2 section:
```rust
// Phase 2: File walking & ignore
let files = walk_files(&args.root, &args.glob);
eprintln!("Found {} files", files.len());
```

Key points:
- ignore crate automatically handles .gitignore, .ignore, .git/info/exclude
- Return Vec<String> of file paths
- Handle UTF-8 path errors gracefully with eprintln
- Only include files (skip directories)
- Glob patterns are collected but filtering deferred to 02-02
</action>
  <verify>`cargo build` succeeds with no errors</verify>
  <done>Running `cargo run -- --root .` prints file count without crashing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds with no errors
- [ ] `cargo run -- --root .` walks current directory respecting .gitignore
- [ ] .gitignore files are actually honored (test with node_modules or similar)
- [ ] Error handling for invalid paths
</verification>

<success_criteria>

- File walking function integrated using ignore crate
- .gitignore files are automatically respected
- File list produced for next phase to consume
- Error handling for walk failures
  </success_criteria>

<output>
After completion, create `.planning/phases/02-file-walking/02-01-SUMMARY.md`
</output>
