---
phase: 07-deterministic-ordering
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [src/main.rs]
autonomous: true
---

<objective>
Implement limit functionality for match results.

Purpose: Allow users to limit the number of matches returned, useful for large result sets.
Output: Matches truncated to specified limit (default 100 from CLI args)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 7-01 provides sorting:
@.planning/phases/07-deterministic-ordering/07-01-SUMMARY.md

# Current state:
@src/main.rs - matches.sort() called, cli::Cli has limit field
@src/cli.rs - Args struct has `limit: usize` field
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply limit to sorted matches</name>
  <files>src/main.rs</files>
  <action>In main function, after sorting, apply limit from CLI args:
```rust
    // Phase 7: Deterministic ordering
    // Sort by file path, then byte_start for consistent output
    matches.sort();
    eprintln!("Matches sorted deterministically");

    // Apply limit (from CLI args, default 100)
    let limit = args.limit.min(matches.len());
    let limited_matches: Vec<Match> = matches.into_iter().take(limit).collect();
    eprintln!("Returning {} of {} matches (limit: {})",
        limited_matches.len(), matches.len(), args.limit);
```

Then update SearchOutput construction to use limited_matches:
```rust
    // Phase 6: JSON output
    let output = SearchOutput {
        execution_id: execution_id.clone(),
        pattern: args.pattern.clone(),
        matches: limited_matches,
        match_count: limited_matches.len(),
    };
```

Also update debug output to use limited_matches:
```rust
    // Debug: print first few matches with context
    for (i, m) in limited_matches.iter().take(3).enumerate() {
```

Key implementation notes:
- `args.limit.min(matches.len())` prevents panic if limit > matches.len()
- `into_iter().take()` consumes matches and creates new Vec
- match_count reflects actual returned count, not total found
- Debug output respects limit (shows first 3 of limited results)
</action>
  <verify>`cargo build` succeeds</verify>
  <done>Limit applied to match results</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds
- [ ] Limit applied from args.limit
- [ ] match_count reflects limited count
- [ ] No panic when limit > match count
- [ ] Debug output shows limited results
</verification>

<success_criteria>

- Results limited to args.limit (default 100)
- match_count accurately reflects returned count
- Works correctly when matches < limit (returns all)
- Works correctly when matches > limit (returns limited set)
- Ready for ordering verification in 07-03
  </success_criteria>

<output>
After completion, create `.planning/phases/07-deterministic-ordering/07-02-SUMMARY.md`
</output>
