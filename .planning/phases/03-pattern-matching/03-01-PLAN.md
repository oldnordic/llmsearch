---
phase: 03-pattern-matching
plan: 01
type: execute
depends_on: []
files_modified: [src/main.rs]
autonomous: true
---

<objective>
Integrate regex crate and compile search pattern.

Purpose: Parse the CLI pattern argument into a regex that can search file contents. This provides the compiled regex for searching.
Output: Compiled Regex object ready for file content search
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 2 provides file list:
@.planning/phases/02-file-walking/02-03-SUMMARY.md

# Current state:
@src/main.rs - walk_files returns Vec<String> of text files
@src/cli.rs - --pattern flag contains search pattern
@Cargo.toml - regex = "1.10" already in dependencies
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compile regex from CLI pattern</name>
  <files>src/main.rs</files>
  <action>Add regex compilation to main function:

1. Add `use regex::Regex;` at top
2. In main, after parsing args, compile the pattern:
```rust
// Phase 3: Pattern matching
// Compile the regex pattern
let regex = match Regex::new(&args.pattern) {
    Ok(re) => re,
    Err(e) => {
        eprintln!("Error: Invalid regex pattern: {}", e);
        std::process::exit(1);
    }
};
eprintln!("Pattern compiled successfully");
```

Key points:
- Use Regex::new() to compile the pattern string
- Exit with error code 1 if pattern is invalid (user-friendly error)
- Use eprintln for error messages (keeps stdout clean for JSON later)
- Pattern comes from args.pattern (required flag, so always present)
- Keep the compiled regex for next plan to use in searching
</action>
  <verify>`cargo build` succeeds</verify>
  <done>Running with valid pattern (e.g., --pattern "test") compiles successfully</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds with no errors
- [ ] `cargo run -- --pattern "test"` prints "Pattern compiled successfully"
- [ ] `cargo run -- --pattern "[" ` (invalid regex) prints error and exits with code 1
</verification>

<success_criteria>

- Regex crate integrated and imported
- Pattern from CLI is compiled successfully
- Invalid patterns produce helpful error messages
- Compiled regex ready for file content search in 03-02
  </success_criteria>

<output>
After completion, create `.planning/phases/03-pattern-matching/03-01-SUMMARY.md`
</output>
